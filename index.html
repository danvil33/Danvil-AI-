<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danvil AI Assistant</title>
    <!-- Include Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Include Marked.js for markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Include Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <!-- Include Particles.js for background effects -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #121212, #1a1a2e);
            color: #ffffff;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            align-items: center;
            padding: 20px;
            padding-bottom: 80px;
            animation: gradientShift 15s ease infinite;
            position: relative;
            overflow-x: hidden;
        }

        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }

        @keyframes gradientShift {
            0% { background: linear-gradient(135deg, #121212, #1a1a2e); }
            50% { background: linear-gradient(135deg, #1a1a2e, #2e1a3c); }
            100% { background: linear-gradient(135deg, #121212, #1a1a2e); }
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 700px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
            background: rgba(30, 30, 30, 0.5);
            padding: 10px 20px;
            border-radius: 12px;
        }

        .header .logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #6e48aa, #9d50bb);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }

        .header .logo:hover {
            transform: rotate(360deg);
        }

        .header .logo-title {
            height: 40px; /* Adjusted to fit header */
            object-fit: contain;
            margin: 0 10px;
            vertical-align: middle;
        }

        .header .icons {
            display: flex;
            gap: 20px;
        }

        .header .icons i {
            font-size: 22px;
            color: #a0a0a0;
            transition: color 0.2s, transform 0.2s;
            cursor: pointer;
        }

        .header .icons i:hover {
            color: #ffffff;
            transform: scale(1.2);
        }

        .content {
            text-align: center;
            width: 100%;
            max-width: 700px;
            margin-bottom: 24px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .content h2 {
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
            background: linear-gradient(90deg, #ffffff, #e0e0e0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .content p {
            font-size: 16px;
            color: #b0b0b0;
            margin-bottom: 28px;
            line-height: 1.6;
        }

        .features-container {
            margin-bottom: 24px;
        }

        .feature-box {
            background-color: #1e1e1e;
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            text-align: left;
            border-left: 4px solid #6e48aa;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .feature-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(110, 72, 170, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feature-box:hover::before {
            opacity: 1;
        }

        .feature-box:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            background-color: #252525;
        }

        .feature-box h3 {
            font-size: 20px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ffffff;
        }

        .feature-box h3 i {
            font-size: 22px;
            color: #6e48aa;
            width: 32px;
            height: 32px;
            background-color: rgba(110, 72, 170, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feature-box p {
            font-size: 14px;
            color: #b0b0b0;
            margin-left: 44px;
            margin-bottom: 0;
        }

        .result-box {
            background-color: #1e1e1e;
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            text-align: left;
            border-left: 4px solid #9d50bb;
            animation: fadeIn 0.5s ease-out forwards;
            position: relative;
        }

        .result-box h3 {
            font-size: 20px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ffffff;
        }

        .result-box h3 i {
            font-size: 22px;
            color: #9d50bb;
            width: 32px;
            height: 32px;
            background-color: rgba(157, 80, 187, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .result-box p {
            font-size: 14px;
            color: #b0b0b0;
            margin-left: 44px;
            margin-bottom: 0;
            line-height: 1.6;
        }

        .copy-btn, .pause-btn {
            position: absolute;
            top: 16px;
            font-size: 18px;
            color: #a0a0a0;
            cursor: pointer;
            transition: color 0.2s, transform 0.2s;
        }

        .copy-btn {
            right: 16px;
        }

        .pause-btn {
            right: 50px;
        }

        .copy-btn:hover, .pause-btn:hover {
            color: #6e48aa;
            transform: scale(1.1);
        }

        .copy-btn.copied {
            color: #50bb50;
        }

        .pause-btn.paused {
            color: #ff4757;
        }

        .input-container {
            width: 100%;
            max-width: 700px;
            margin-top: auto;
            position: sticky;
            bottom: 70px;
            background-color: transparent;
            padding: 10px 0;
            z-index: 90;
        }

        .input-section {
            background-color: #1e1e1e;
            border-radius: 24px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border: 1px solid #2a2a2a;
        }

        .input-section textarea {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 16px;
            flex-grow: 1;
            padding: 8px 12px;
            outline: none;
            resize: none;
            height: 40px;
            width: 100%;
            font-family: inherit;
        }

        .input-section textarea::placeholder {
            color: #606060;
        }

        .input-section .icons {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .input-section .icons i {
            font-size: 22px;
            color: #a0a0a0;
            transition: color 0.2s, transform 0.2s;
            cursor: pointer;
        }

        .input-section .icons i:hover {
            color: #6e48aa;
            transform: scale(1.1);
        }

        .input-section .icons i:last-child {
            color: #6e48aa;
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            background-color: #1e1e1e;
            padding: 16px 0;
            max-width: 700px;
            margin: 0 auto;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }

        .footer i {
            font-size: 24px;
            color: #a0a0a0;
            padding: 10px;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .footer i:hover {
            color: #ffffff;
            background-color: #2a2a2a;
            transform: scale(1.1);
        }

        .footer .active {
            color: #6e48aa;
            position: relative;
        }

        .footer .active::after {
            content: '3';
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: #ff4757;
            color: #ffffff;
            font-size: 10px;
            font-weight: bold;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feature-box {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .feature-box:nth-child(1) { animation-delay: 0.1s; }
        .feature-box:nth-child(2) { animation-delay: 0.2s; }
        .feature-box:nth-child(3) { animation-delay: 0.3s; }

        .quick-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-action {
            background-color: #1e1e1e;
            border-radius: 18px;
            padding: 12px 18px;
            font-size: 14px;
            color: #b0b0b0;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #2a2a2a;
        }

        .quick-action:hover {
            background-color: #252525;
            color: #ffffff;
            transform: translateY(-2px);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 44px;
            margin-top: 8px;
        }

        .typing-dot {
            width: 10px;
            height: 10px;
            background-color: #9d50bb;
            border-radius: 50%;
            opacity: 0.4;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-6px); opacity: 1; }
        }

        .ai-response {
            margin-left: 44px;
        }

        .ai-response p {
            margin-bottom: 12px;
        }

        .ai-response ul, .ai-response ol {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .ai-response li {
            margin-bottom: 8px;
        }

        .ai-response code {
            background-color: #2a2a2a;
            padding: 3px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .ai-response pre {
            background-color: #2a2a2a;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 12px;
        }

        .model-selector {
            position: absolute;
            bottom: 100%;
            right: 0;
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            gap: 8px;
            width: 220px;
            margin-bottom: 8px;
            z-index: 110;
        }

        .model-selector.active {
            display: flex;
        }

        .model-option {
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color 0.2s;
        }

        .model-option:hover {
            background-color: #2a2a2a;
        }

        .model-option i {
            color: #6e48aa;
            font-size: 18px;
        }

        .model-option .model-name {
            flex-grow: 1;
            font-weight: 500;
        }

        .model-option .model-desc {
            font-size: 0.8em;
            color: #b0b0b0;
        }

        .chat-history {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        .chat-history.active {
            display: flex;
        }

        .chat-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chat-history-close {
            font-size: 26px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .chat-history-close:hover {
            color: #ff4757;
        }

        .history-item {
            padding: 14px;
            margin-bottom: 12px;
            background-color: #1e1e1e;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .history-item:hover {
            background-color: #252525;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        .settings-panel.active {
            display: flex;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .settings-close {
            font-size: 26px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .settings-close:hover {
            color: #ff4757;
        }

        .settings-option {
            padding: 14px;
            margin-bottom: 12px;
            background-color: #1e1e1e;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #2a2a2a;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #6e48aa;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 5px solid #6e48aa;
            border-top: 5px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 1000;
        }

        .loading-spinner.active {
            display: block;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @media (max-width: 700px) {
            .content h2 {
                font-size: 28px;
            }

            .content p {
                font-size: 14px;
            }

            .quick-actions {
                gap: 8px;
            }

            .quick-action {
                padding: 10px 14px;
                font-size: 13px;
            }

            .header {
                padding: 8px 16px;
            }

            .header .logo-title {
                height: 32px; /* Smaller logo for mobile */
            }
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div class="loading-spinner" id="loading-spinner"></div>
    <div class="header">
        <div class="logo" aria-label="Danvil Logo">DV</div>
        <img src="https://raw.githubusercontent.com/danvil33/Danvil-AI-/refs/heads/main/IMG-20250427-WA0027.jpg" alt="Danvil AI Logo" class="logo-title" aria-label="Danvil AI Logo">
        <div class="icons" aria-label="Header navigation">
            <i class="fas fa-history" id="history-btn" title="Chat History"></i>
            <i class="fas fa-cog" id="settings-btn" title="Settings"></i>
        </div>
    </div>

    <div class="content">
        <h2>Danvil AI</h2>
        <p>Unlock a world of knowledge and creativity with Danvil’s advanced AI capabilities.</p>

        <div class="quick-actions">
            <div class="quick-action">Write an email</div>
            <div class="quick-action">Explain concept</div>
            <div class="quick-action">Debug code</div>
            <div class="quick-action">Summarize text</div>
            <div class="quick-action">Generate image</div>
        </div>

        <div class="features-container">
            <div class="feature-box" data-action="DanvilSearch">
                <h3><i class="fas fa-search" aria-hidden="true"></i>DanvilSearch</h3>
                <p>Harness the power of contextual search to get precise answers.</p>
            </div>

            <div class="feature-box" data-action="Think">
                <h3><i class="fas fa-brain" aria-hidden="true"></i>Think</h3>
                <p>Tackle complex problems with step-by-step reasoning across multiple domains.</p>
            </div>

            <div class="feature-box" data-action="Work submission">
                <h3><i class="fas fa-magic" aria-hidden="true"></i>Task Automation</h3>
                <p>Submit tasks and let Danvil handle them with precision and efficiency.</p>
            </div>
        </div>

        <div class="results-container"></div>
    </div>

    <div class="input-container">
        <div class="model-selector" id="model-selector">
            <div class="model-option" data-model="danvil-pro">
                <i class="fas fa-robot"></i>
                <div>
                    <div class="model-name">Danvil Pro</div>
                    <div class="model-desc">Most advanced AI model</div>
                </div>
            </div>
            <div class="model-option" data-model="danvil-fast">
                <i class="fas fa-bolt"></i>
                <div>
                    <div class="model-name">Danvil Fast</div>
                    <div class="model-desc">Optimized for speed</div>
                </div>
            </div>
            <div class="model-option" data-model="danvil-claude">
                <i class="fas fa-book"></i>
                <div>
                    <div class="model-name">Danvil Claude</div>
                    <div class="model-desc">Deep reasoning expert</div>
                </div>
            </div>
        </div>

        <div class="input-section">
            <textarea id="user-input" placeholder="Ask Danvil anything..." aria-label="Ask Danvil"></textarea>
            <div class="icons">
                <i class="fas fa-microphone" id="mic-btn" title="Voice input"></i>
                <i class="fas fa-brain" id="model-btn" title="Select AI Model"></i>
                <i class="fas fa-paper-plane" id="send-btn" title="Send"></i>
            </div>
        </div>
    </div>

    <div class="footer">
        <i class="fas fa-home" title="Home"></i>
        <i class="fas fa-compass" title="Discover"></i>
        <i class="fas fa-robot active" title="Danvil"></i>
        <i class="fas fa-book" title="Library"></i>
        <i class="fas fa-user" title="Profile"></i>
    </div>

    <div class="chat-history" id="chat-history">
        <div class="chat-history-header">
            <h3>Chat History</h3>
            <i class="fas fa-times chat-history-close" id="history-close"></i>
        </div>
        <div class="history-items"></div>
    </div>

    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <h3>Settings</h3>
            <i class="fas fa-times settings-close" id="settings-close"></i>
        </div>

        <div class="settings-option">
            <span>Dark Mode</span>
            <label class="toggle-switch">
                <input type="checkbox" id="dark-mode-toggle" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="settings-option">
            <span>Voice Responses</span>
            <label class="toggle-switch">
                <input type="checkbox" id="voice-toggle">
                <span class="slider"></span>
            </label>
        </div>

        <div class="settings-option">
            <span>Auto-scroll</span>
            <label class="toggle-switch">
                <input type="checkbox" id="scroll-toggle" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="settings-option">
            <span>Dynamic Theme</span>
            <label class="toggle-switch">
                <input type="checkbox" id="theme-toggle" checked>
                <span class="slider"></span>
            </label>
        </div>

        <div class="settings-option">
            <span>Clear Chat History</span>
            <button id="clear-history" style="background: none; border: none; color: #ff4757; cursor: pointer;">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </div>

    <script>
        // Initialize variables
        let currentModel = 'danvil-pro';
        let chatHistory = JSON.parse(localStorage.getItem('danvilChatHistory')) || [];
        let isTyping = false;
        let isLoading = false;
        let isPaused = false;
        let typingInterval = null;
        const cache = new Map(); // In-memory cache for API responses

        // DOM elements
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const micBtn = document.getElementById('mic-btn');
        const modelBtn = document.getElementById('model-btn');
        const modelSelector = document.getElementById('model-selector');
        const resultsContainer = document.querySelector('.results-container');
        const historyBtn = document.getElementById('history-btn');
        const historyPanel = document.getElementById('chat-history');
        const historyClose = document.getElementById('history-close');
        const historyItems = document.querySelector('.history-items');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsPanel = document.getElementById('settings-panel');
        const settingsClose = document.getElementById('settings-close');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const voiceToggle = document.getElementById('voice-toggle');
        const scrollToggle = document.getElementById('scroll-toggle');
        const themeToggle = document.getElementById('theme-toggle');
        const clearHistoryBtn = document.getElementById('clear-history');
        const loadingSpinner = document.getElementById('loading-spinner');

        // Initialize Particles.js
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: '#6e48aa' },
                shape: { type: 'circle' },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: { enable: true, distance: 150, color: '#6e48aa', opacity: 0.4, width: 1 },
                move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
            },
            interactivity: {
                detect_on: 'canvas',
                events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
                modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
            },
            retina_detect: true
        });

        // Auto-resize textarea
        function autoResizeTextarea() {
            userInput.style.height = '40px';
            userInput.style.height = `${Math.min(userInput.scrollHeight, 120)}px`;
        }

        userInput.addEventListener('input', autoResizeTextarea);

        // Feature box interaction
        document.querySelectorAll('.feature-box').forEach(box => {
            box.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                this.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 200);

                let response = '';
                switch(action) {
                    case 'DanvilSearch':
                        response = `### DanvilSearch Activated\n\nEnter your query to explore comprehensive answers powered by AI.`;
                        break;
                    case 'Think':
                        response = `### Think Mode Enabled\n\nReady to solve complex problems with detailed reasoning. Try asking for:\n- Mathematical solutions\n- Scientific explanations\n- Code analysis`;
                        break;
                    case 'Work submission':
                        response = `### Task Automation Ready\n\nSubmit your task details, requirements, and deadline. Danvil will process and deliver results efficiently.`;
                        break;
                }

                addMessageToChat('Danvil', response, 'ai');
            });
        });

        // Quick actions interaction
        document.querySelectorAll('.quick-action').forEach(action => {
            action.addEventListener('click', function() {
                const text = this.textContent;
                userInput.placeholder = `Danvil: ${text}...`;
                this.style.backgroundColor = '#6e48aa';
                this.style.color = '#ffffff';
                setTimeout(() => {
                    this.style.backgroundColor = '';
                    this.style.color = '';
                }, 1000);

                let prompt = '';
                switch(text.toLowerCase()) {
                    case 'write an email':
                        prompt = 'Compose a professional email about:';
                        break;
                    case 'explain concept':
                        prompt = 'Explain this concept in simple terms:';
                        break;
                    case 'debug code':
                        prompt = 'Help me debug this codebase:\n```\n[Your code here]\n```';
                        break;
                    case 'summarize text':
                        prompt = 'Summarize this text for me:';
                        break;
                    case 'generate image':
                        prompt = 'Describe the image you want me to generate:';
                        break;
                }

                userInput.focus();
                userInput.value = prompt;
            });
        });

        // Model selector toggle
        modelBtn.addEventListener('click', () => {
            modelSelector.classList.toggle('active');
        });

        // Model selection
        document.querySelectorAll('.model-option').forEach(option => {
            option.addEventListener('click', function() {
                currentModel = this.getAttribute('data-model');
                modelSelector.classList.remove('active');

                const notification = document.createElement('div');
                notification.className = 'result-box';
                notification.innerHTML = `
                    <h3><i class="fas fa-check-circle"></i>Model Changed</h3>
                    <p>Now using ${this.querySelector('.model-name').textContent}</p>
                `;
                resultsContainer.appendChild(notification);
                notification.scrollIntoView({ behavior: 'smooth' });

                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            });
        });

        // Close model selector when clicking outside
        document.addEventListener('click', (e) => {
            if (!modelBtn.contains(e.target) && !modelSelector.contains(e.target)) {
                modelSelector.classList.remove('active');
            }
        });

        // Chat history panel
        historyBtn.addEventListener('click', () => {
            renderHistory();
            historyPanel.classList.add('active');
        });

        historyClose.addEventListener('click', () => {
            historyPanel.classList.remove('active');
        });

        // Settings panel
        settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.add('active');
        });

        settingsClose.addEventListener('click', () => {
            settingsPanel.classList.remove('active');
        });

        // Clear history
        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all chat history?')) {
                chatHistory = [];
                localStorage.setItem('danvilChatHistory', JSON.stringify(chatHistory));
                renderHistory();
            }
        });

        // Allow pressing Enter to submit (with Shift+Enter for new line)
        userInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey && !isTyping) {
                event.preventDefault();
                sendMessage();
            }
        });

        // Click send button to send message
        sendBtn.addEventListener('click', sendMessage);

        // Function to send message
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            addMessageToChat('You', message, 'user');
            userInput.value = '';
            autoResizeTextarea();

            showTypingIndicator();
            showLoadingSpinner();

            try {
                let response = await generateAIResponse(message);
                hideTypingIndicator();
                hideLoadingSpinner();

                // Handle "who created you" queries
                if (message.toLowerCase().includes('who created you') || message.toLowerCase().includes('who made you')) {
                    response = `### About My Creator\n\nI am Danvil, created by Danvil, a talented student from MUST University. My purpose is to assist users with knowledge and creativity, built from scratch with passion and innovation.`;
                }

                // Type out response with pause/resume functionality
                typeResponse(response);
            } catch (error) {
                hideTypingIndicator();
                hideLoadingSpinner();
                addMessageToChat('Danvil', `### Error\n\nSomething went wrong: ${error.message}`, 'ai');
            }
        }

        // Function to add message to chat
        function addMessageToChat(sender, message, type) {
            const messageId = 'msg-' + Date.now();
            const messageBox = document.createElement('div');
            messageBox.className = 'result-box';
            messageBox.id = messageId;

            if (type === 'user') {
                messageBox.innerHTML = `
                    <h3><i class="fas fa-user"></i>${sender}</h3>
                    <p>${message.replace(/\n/g, '<br>')}</p>
                `;
            } else {
                const processedMessage = marked.parse(message);
                messageBox.innerHTML = `
                    <h3><i class="fas fa-robot"></i>${sender}</h3>
                    <div class="ai-response">${processedMessage}</div>
                    <i class="fas fa-copy copy-btn" title="Copy Response"></i>
                    <i class="fas fa-pause pause-btn" title="Pause/Resume"></i>
                `;
                const copyBtn = messageBox.querySelector('.copy-btn');
                const pauseBtn = messageBox.querySelector('.pause-btn');

                copyBtn.addEventListener('click', () => {
                    navigator.clipboard.writeText(message).then(() => {
                        copyBtn.classList.add('copied');
                        copyBtn.classList.remove('fa-copy');
                        copyBtn.classList.add('fa-check');
                        setTimeout(() => {
                            copyBtn.classList.remove('copied');
                            copyBtn.classList.remove('fa-check');
                            copyBtn.classList.add('fa-copy');
                        }, 2000);
                    });
                });

                pauseBtn.addEventListener('click', () => {
                    isPaused = !isPaused;
                    pauseBtn.classList.toggle('paused', isPaused);
                    pauseBtn.classList.toggle('fa-pause', !isPaused);
                    pauseBtn.classList.toggle('fa-play', isPaused);
                    pauseBtn.title = isPaused ? 'Resume' : 'Pause';
                });

                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }

            resultsContainer.appendChild(messageBox);

            if (scrollToggle.checked) {
                messageBox.scrollIntoView({ behavior: 'smooth' });
            }

            if (type !== 'typing') {
                chatHistory.push({
                    id: messageId,
                    sender,
                    message,
                    type,
                    timestamp: new Date().toISOString(),
                    model: type === 'ai' ? currentModel : null
                });

                localStorage.setItem('danvilChatHistory', JSON.stringify(chatHistory));
            }

            return messageBox;
        }

        // Function to show typing indicator
        function showTypingIndicator() {
            isTyping = true;
            const typingBox = document.createElement('div');
            typingBox.className = 'result-box';
            typingBox.id = 'typing-indicator';
            typingBox.innerHTML = `
                <h3><i class="fas fa-robot"></i>Danvil</h3>
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            resultsContainer.appendChild(typingBox);

            if (scrollToggle.checked) {
                typingBox.scrollIntoView({ behavior: 'smooth' });
            }

            chatHistory.push({
                id: 'typing-indicator',
                sender: 'Danvil',
                message: '...',
                type: 'typing',
                timestamp: new Date().toISOString()
            });
        }

        // Function to hide typing indicator
        function hideTypingIndicator() {
            isTyping = false;
            const typingBox = document.getElementById('typing-indicator');
            if (typingBox) typingBox.remove();

            chatHistory = chatHistory.filter(item => item.id !== 'typing-indicator');
            localStorage.setItem('danvilChatHistory', JSON.stringify(chatHistory));
        }

        // Function to show loading spinner
        function showLoadingSpinner() {
            isLoading = true;
            loadingSpinner.classList.add('active');
        }

        // Function to hide loading spinner
        function hideLoadingSpinner() {
            isLoading = false;
            loadingSpinner.classList.remove('active');
        }

        // Function to simulate typing effect with pause/resume
        function typeResponse(response) {
            const messageBox = addMessageToChat('Danvil', '', 'ai');
            const responseDiv = messageBox.querySelector('.ai-response');
            let index = 0;
            const chars = response.split('');

            function typeChar() {
                if (isPaused) {
                    typingInterval = setTimeout(typeChar, 100);
                    return;
                }

                if (index < chars.length) {
                    responseDiv.innerHTML = marked.parse(chars.slice(0, index + 1).join(''));
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightElement(block);
                    });
                    index++;
                    typingInterval = setTimeout(typeChar, 10);
                } else {
                    clearTimeout(typingInterval);
                    if (voiceToggle.checked) {
                        speakResponse(response);
                    }
                }
            }

            typeChar();
        }

        // Function to generate AI response using AIML API
        async function generateAIResponse(prompt) {
            if (prompt.length > 1000) {
                return `### Processing Long Input\n\nYour input is quite detailed! Here's a summary:\n\n${prompt.substring(0, 500)}...\n\nPlease specify a key aspect to focus on or shorten your query for a detailed response.`;
            }

            const cacheKey = `ai_${prompt}_${currentModel}`;
            if (cache.has(cacheKey)) {
                return cache.get(cacheKey);
            }

            try {
                const response = await fetch('https://api.aimlapi.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer b86e6369d8a3444e92654b083932b696'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are Danvil, an advanced AI assistant created by Danvil, a student from MUST University. Provide detailed, accurate, and engaging responses in markdown format. Use headers, lists, and code blocks where appropriate. Do not mention Open AI or any other AI providers in your responses.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                cache.set(cacheKey, aiResponse);
                return aiResponse;

            } catch (error) {
                console.error('AIML API error:', error);
                throw new Error('Failed to fetch response from AI. Please try again later.');
            }
        }

        // Function to speak AI response
        function speakResponse(text) {
            const cleanText = text.replace(/[#*`]+/g, '').replace(/\n/g, ' ');
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'en-US';
            utterance.volume = 1;
            utterance.rate = 1;
            utterance.pitch = 1;
            window.speechSynthesis.speak(utterance);
        }

        // Microphone input
        micBtn.addEventListener('click', () => {
            if (!('webkitSpeechRecognition' in window)) {
                alert('Speech recognition is not supported. Try a modern browser like Chrome.');
                return;
            }

            const recognition = new webkitSpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.start();
            micBtn.style.color = '#ff4757';

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                micBtn.style.color = '';
                sendMessage();
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                micBtn.style.color = '';
                alert('Speech recognition failed. Please try again.');
            };

            recognition.onend = () => {
                micBtn.style.color = '';
            };
        });

        // Render chat history
        function renderHistory() {
            historyItems.innerHTML = '';
            if (chatHistory.length === 0) {
                historyItems.innerHTML = '<p>No chat history available.</p>';
                return;
            }

            chatHistory
                .filter(item => item.type !== 'typing')
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    const preview = item.message.length > 50 ? item.message.substring(0, 50) + '...' : item.message;
                    historyItem.innerHTML = `
                        <strong>${item.sender}</strong>: ${preview}
                        <small style="color: #b0b0b0;">${new Date(item.timestamp).toLocaleString()}</small>
                    `;
                    historyItem.addEventListener('click', () => {
                        resultsContainer.innerHTML = '';
                        const index = chatHistory.findIndex(h => h.id === item.id);
                        chatHistory.slice(0, index + 1).forEach(history => {
                            if (history.type !== 'typing') {
                                addMessageToChat(history.sender, history.message, history.type);
                            }
                        });
                        historyPanel.classList.remove('active');
                    });
                    historyItems.appendChild(historyItem);
                });
        }

        // Theme and mode toggles
        darkModeToggle.addEventListener('change', () => {
            document.body.style.background = darkModeToggle.checked 
                ? 'linear-gradient(135deg, #121212, #1a1a2e)' 
                : 'linear-gradient(135deg, #f0f0f0, #ffffff)';
            document.body.style.color = darkModeToggle.checked ? '#ffffff' : '#000000';
            document.querySelector('.input-section').style.backgroundColor = darkModeToggle.checked ? '#1e1e1e' : '#ffffff';
            document.querySelector('.footer').style.backgroundColor = darkModeToggle.checked ? '#1e1e1e' : '#ffffff';
        });

        themeToggle.addEventListener('change', () => {
            document.body.style.animation = themeToggle.checked ? 'gradientShift 15s ease infinite' : 'none';
        });

        // Initialize Highlight.js
        hljs.highlightAll();

        // Auto-scroll observer
        const observer = new MutationObserver(() => {
            if (scrollToggle.checked) {
                const latestMessage = resultsContainer.lastElementChild;
                if (latestMessage) {
                    latestMessage.scrollIntoView({ behavior: 'smooth' });
                }
            }
        });
        observer.observe(resultsContainer, { childList: true });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth <= 700) {
                document.querySelector('.content h2').style.fontSize = '28px';
                document.querySelectorAll('.quick-action').forEach(action => {
                    action.style.padding = '10px 14px';
                    action.style.fontSize = '13px';
                });
            } else {
                document.querySelector('.content h2').style.fontSize = '32px';
                document.querySelectorAll('.quick-action').forEach(action => {
                    action.style.padding = '12px 18px';
                    action.style.fontSize = '14px';
                });
            }
        });

        // Initialize chat history
        renderHistory();
    </script>
</body>
</html>
